---
import { getCollection } from "astro:content";
import { getImage } from "astro:assets";
import Grilla from "./jsx/Grilla.jsx";

const works = await getCollection("works");
const currentLang = Astro.currentLocale || "es";
const filteredWorks = works.filter((work: { slug: string; }) =>
    work.slug.startsWith(`${currentLang}/`),
);

const optimizedWorks = [];
for (const work of filteredWorks) {
    const optimizedImage = await getImage({
        src: work.data.image,
        format: "webp",
        width: 1400,
    });
    const tinyImage = await getImage({
        src: work.data.image,
        format: "webp",
        width: 20,
    });
    optimizedWorks.push({
        slug: work.slug,
        data: {
            ...work.data,
            image: {
                src: optimizedImage.src,
                attributes: optimizedImage.attributes,
            },
            imagePlaceholder: tinyImage.src,
        },
    });
}
---

<Grilla works={optimizedWorks} client:visible />
